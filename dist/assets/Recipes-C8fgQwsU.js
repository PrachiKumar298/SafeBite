import{c as L,s as w,u as M,r as l,R as e,B as A}from"./index-DdU1dMS1.js";import{g as _,d as z,s as T}from"./savedRecipesService-OT_fr6tC.js";import{g as j}from"./allergyService-Cag4xq3b.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=L("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=L("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);async function D(t){const{data:a}=await w.from("my_recipes").select("*").eq("user_id",t).order("created_at",{ascending:!1});return a||[]}async function F(t,a,r,i){await w.from("my_recipes").insert({user_id:t,title:a,ingredients:r,instructions:i})}async function q(t){await w.from("my_recipes").delete().eq("id",t)}function K(){const{user:t}=M(),a=t==null?void 0:t.id,[r,i]=l.useState(""),[m,d]=l.useState(""),[o,u]=l.useState(""),[c,E]=l.useState([]),[y,p]=l.useState(!0);l.useEffect(()=>{a&&g()},[a]);const g=async()=>{p(!0);const n=await D(a);E(n),p(!1)},x=async()=>{r.trim()&&(await F(a,r,m.split(","),o),i(""),d(""),u(""),g())},N=async n=>{await q(n),g()};return y?e.createElement("div",null,"Loading your recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Add New Recipe"),e.createElement("div",{className:"p-4 bg-white rounded-lg shadow mb-8"},e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Recipe Title",value:r,onChange:n=>i(n.target.value)}),e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Ingredients (comma separated)",value:m,onChange:n=>d(n.target.value)}),e.createElement("textarea",{className:"w-full p-3 border rounded mb-3",placeholder:"Instructions",value:o,onChange:n=>u(n.target.value)}),e.createElement("button",{className:"px-4 py-2 bg-amber-600 text-white rounded-lg",onClick:x},"Save Recipe")),e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Your Recipes"),c.length===0&&e.createElement("p",{className:"text-gray-500"},"No recipes yet."),e.createElement("div",{className:"space-y-4"},c.map(n=>e.createElement("div",{key:n.id,className:"p-4 bg-amber-50 rounded-lg"},e.createElement("h3",{className:"font-bold text-lg"},n.title),e.createElement("p",{className:"text-sm mt-1"},e.createElement("strong",null,"Ingredients:")," ",n.ingredients.join(", ")),e.createElement("p",{className:"text-sm mt-1 whitespace-pre-wrap"},n.instructions),e.createElement("button",{onClick:()=>N(n.id),className:"mt-3 text-red-600 hover:underline"},"Delete")))))}function U(){const{user:t}=M(),a=t==null?void 0:t.id,[r,i]=l.useState([]),[m,d]=l.useState(!0);l.useEffect(()=>{a&&o()},[a]);const o=async()=>{d(!0);const c=await _(a);i(c),d(!1)},u=async c=>{await z(c),o()};return m?e.createElement("div",null,"Loading saved recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-4"},"Saved Recipes"),r.length===0&&e.createElement("p",{className:"text-gray-500"},"No saved recipes yet."),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.map(c=>e.createElement("div",{key:c.id,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:c.thumbnail,alt:c.title,className:"rounded-lg mb-2"}),e.createElement("h3",{className:"font-bold"},c.title),e.createElement("button",{onClick:()=>u(c.id),className:"mt-2 text-red-600 hover:underline"},"Remove")))))}function V(){const{user:t}=M(),a=t==null?void 0:t.id,[r,i]=l.useState([]),[m,d]=l.useState([]),[o,u]=l.useState([]),[c,E]=l.useState(!0),[y,p]=l.useState("");l.useEffect(()=>{a&&g()},[a]);const g=async()=>{const f=(await j(a)).map(v=>v.allergen.toLowerCase());i(f),await x(),await N(f)},x=async()=>{const{data:s,error:f}=await w.from("related_foods").select("ingredients");if(!f&&s){const v=s.flatMap(R=>R.ingredients.map(S=>S.toLowerCase()));d(v)}},N=async s=>{E(!0);const R=(await(await fetch("https://www.themealdb.com/api/json/v1/1/search.php?s=")).json()).meals||[],S=[...s,...m].map(k=>k.toLowerCase()),I=R.filter(k=>{const C=[];for(let b=1;b<=20;b++){const h=k[`strIngredient${b}`];h&&h.trim()!==""&&C.push(h.toLowerCase())}return!C.some(b=>S.some(h=>b.includes(h)))});u(I),E(!1)},n=async s=>{p(s.idMeal),await T(a,s.strMeal,s.strMealThumb,s.idMeal),p("")};return c?e.createElement("p",null,"Loading..."):o.length===0?e.createElement("p",{className:"text-gray-500"},"No safe recipes found based on your allergies."):e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},o.map(s=>e.createElement("div",{key:s.idMeal,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:s.strMealThumb,className:"rounded-lg mb-3",alt:s.strMeal}),e.createElement("h3",{className:"font-bold text-lg"},s.strMeal),e.createElement("p",{className:"text-sm text-gray-600"},"Category: ",s.strCategory),e.createElement("button",{onClick:()=>n(s),disabled:y===s.idMeal,className:"mt-3 bg-amber-600 text-white px-3 py-2 rounded-lg"},y===s.idMeal?"Saving...":"Save Recipe"))))}function J(){const[t,a]=l.useState("mine");return e.createElement("div",{className:"max-w-4xl mx-auto"},e.createElement("h1",{className:"text-3xl font-bold mb-6"},"Recipes"),e.createElement("div",{className:"flex gap-3 mb-6"},e.createElement("button",{onClick:()=>a("mine"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="mine"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(A,{size:18})," My Recipes"),e.createElement("button",{onClick:()=>a("recommended"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="recommended"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement($,{size:18})," Recommended"),e.createElement("button",{onClick:()=>a("saved"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="saved"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(B,{size:18})," Saved")),t==="mine"&&e.createElement(K,null),t==="recommended"&&e.createElement(V,null),t==="saved"&&e.createElement(U,null))}export{J as default};
