import{u as b,r as u,R as e}from"./index-D4drG40M.js";import{g as w}from"./allergyService-CDbd7jjM.js";async function v(a){var i,d,n,r,s;const c=a.trim().toLowerCase();let t=await fetch(`https://rxnav.nlm.nih.gov/REST/rxcui.json?name=${encodeURIComponent(c)}`).then(l=>l.json()).catch(()=>null);if((d=(i=t==null?void 0:t.idGroup)==null?void 0:i.rxnormId)!=null&&d[0])return t.idGroup.rxnormId[0];t=await fetch(`https://rxnav.nlm.nih.gov/REST/approximateTerm.json?term=${encodeURIComponent(c)}`).then(l=>l.json()).catch(()=>null);const o=(s=(r=(n=t==null?void 0:t.approximateGroup)==null?void 0:n.candidate)==null?void 0:r[0])==null?void 0:s.rxcui;return o||null}async function S(a){var n;const c=`https://rxnav.nlm.nih.gov/REST/rxcui/${a}/related.json?tty=IN`,t=await fetch(c);if(!t.ok)throw new Error("Ingredient lookup failed");const d=(((n=(await t.json()).relatedGroup)==null?void 0:n.conceptGroup)||[]).flatMap(r=>{var s;return((s=r.conceptProperties)==null?void 0:s.map(l=>l.name.toLowerCase()))||[]});return[...new Set(d)]}async function C(a,c=[]){if(!a.trim())return{medicineName:a,safe:null,ingredients:[],allergens:[],message:"No medicine name provided"};const t=await v(a);if(!t)return{medicineName:a,safe:null,ingredients:[],allergens:[],message:"Medicine not found"};let o=await S(t);o.length===0&&(o=[a.toLowerCase()]);const i=[],d=["penicillin","amoxicillin","ampicillin","augmentin","clavulanate","oxacillin","dicloxacillin","nafcillin","methicillin","flucloxacillin","piperacillin","tazobactam"],n=s=>(s||"").toLowerCase().trim();for(const s of c){const l=n(s);for(const f of o){const g=n(f);g.includes(l)&&i.push(l),l==="penicillin"&&d.some(p=>g.includes(p))&&i.push(`penicillin-family: ${g}`)}}const r=[...new Set(i)];return{medicineName:a,safe:r.length===0,ingredients:o,allergens:r,message:r.length===0?"No allergenic ingredients found":void 0}}function R(){const{user:a}=b(),c=a==null?void 0:a.id,[t,o]=u.useState([]),[i,d]=u.useState(""),[n,r]=u.useState(null),[s,l]=u.useState(!0),[f,g]=u.useState(!1),[p,h]=u.useState(null);u.useEffect(()=>{c&&E()},[c]);const E=async()=>{l(!0);const x=(await w(c)).map(y=>y.allergen.toLowerCase());o(x),l(!1)},N=async()=>{if(i.trim()){g(!0),h(null),r(null);try{const m=await C(i,t);r(m)}catch{h("Unable to fetch medicine data. Try another term.")}g(!1)}};return s?e.createElement("div",null,"Loading your allergies..."):e.createElement("div",{className:"max-w-2xl mx-auto"},e.createElement("h1",{className:"text-3xl font-bold mb-4"},"Medicine Safety Checker"),e.createElement("p",{className:"text-gray-600 mb-6"},"Search any medicine name to check if ingredients contain allergens."),e.createElement("div",{className:"flex gap-3 mb-6"},e.createElement("input",{className:"flex-1 p-3 border rounded-lg",placeholder:"e.g., Amoxicillin, Ibuprofen, Lactaid",value:i,onChange:m=>d(m.target.value)}),e.createElement("button",{onClick:N,className:"px-4 py-2 text-white rounded-lg",style:{background:"var(--sb-accent)",opacity:f?.7:1},disabled:f},f?"Checking...":"Search")),p&&e.createElement("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg mb-4"},p),n&&e.createElement("div",{className:"p-5 rounded-xl shadow bg-white"},e.createElement("h2",{className:"text-xl font-semibold mb-2"},n.medicineName),n.safe?e.createElement("div",null,e.createElement("p",{className:"text-green-600 font-semibold text-lg"},"SAFE ✔"),e.createElement("p",{className:"text-gray-600 mt-2"},"No allergenic ingredients detected.")):e.createElement("div",null,e.createElement("p",{className:"text-red-600 font-semibold text-lg"},"UNSAFE ❌"),e.createElement("p",{className:"text-gray-600 mt-2"},"Contains allergens:"),e.createElement("ul",{className:"list-disc ml-6 mt-1 text-red-600 font-medium"},n.allergens.map(m=>e.createElement("li",{key:m},m)))),e.createElement("div",{className:"mt-4"},e.createElement("h3",{className:"text-lg font-semibold mb-1"},"Detected Ingredients"),e.createElement("div",{className:"bg-gray-50 border rounded-lg p-3 text-sm text-gray-700"},n.ingredients.length>0?e.createElement("ul",{className:"list-disc ml-5"},n.ingredients.map((m,x)=>e.createElement("li",{key:x},m))):e.createElement("p",null,"No ingredient info available.")))))}export{R as default};
