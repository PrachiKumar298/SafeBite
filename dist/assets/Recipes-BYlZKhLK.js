import{c as N,s as v,u as x,r as i,R as e,B as S}from"./index-C8kgIiwg.js";import{g as M,d as C,s as L}from"./savedRecipesService-BgeXtqGP.js";import{g as I}from"./allergyService-oEBoJPD2.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=N("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=N("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);async function B(t){const{data:a}=await v.from("my_recipes").select("*").eq("user_id",t).order("created_at",{ascending:!1});return a||[]}async function D(t,a,n,s){await v.from("my_recipes").insert({user_id:t,title:a,ingredients:n,instructions:s})}async function V(t){await v.from("my_recipes").delete().eq("id",t)}function z(){const{user:t}=x(),a=t==null?void 0:t.id,[n,s]=i.useState(""),[r,c]=i.useState(""),[o,u]=i.useState(""),[g,f]=i.useState([]),[m,b]=i.useState(!0);i.useEffect(()=>{a&&p()},[a]);const p=async()=>{b(!0);const d=await B(a);f(d),b(!1)},h=async()=>{n.trim()&&(await D(a,n,r.split(","),o),s(""),c(""),u(""),p())},E=async d=>{await V(d),p()};return m?e.createElement("div",null,"Loading your recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Add New Recipe"),e.createElement("div",{className:"p-4 bg-white rounded-lg shadow mb-8"},e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Recipe Title",value:n,onChange:d=>s(d.target.value)}),e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Ingredients (comma separated)",value:r,onChange:d=>c(d.target.value)}),e.createElement("textarea",{className:"w-full p-3 border rounded mb-3",placeholder:"Instructions",value:o,onChange:d=>u(d.target.value)}),e.createElement("button",{className:"px-4 py-2 text-white rounded-lg",style:{background:"var(--sb-accent)"},onClick:h},"Save Recipe")),e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Your Recipes"),g.length===0&&e.createElement("p",{className:"text-gray-500"},"No recipes yet."),e.createElement("div",{className:"space-y-4"},g.map(d=>e.createElement("div",{key:d.id,className:"p-4 bg-amber-50 rounded-lg"},e.createElement("h3",{className:"font-bold text-lg"},d.title),e.createElement("p",{className:"text-sm mt-1"},e.createElement("strong",null,"Ingredients:")," ",d.ingredients.join(", ")),e.createElement("p",{className:"text-sm mt-1 whitespace-pre-wrap"},d.instructions),e.createElement("button",{onClick:()=>E(d.id),className:"mt-3 text-red-600 hover:underline"},"Delete")))))}function j(){const{user:t}=x(),a=t==null?void 0:t.id,[n,s]=i.useState([]),[r,c]=i.useState(!0);i.useEffect(()=>{a&&o()},[a]);const o=async()=>{c(!0);const m=await M(a);s(m),c(!1)},u=async m=>{await C(m),o()},[g,f]=i.useState(null);return r?e.createElement("div",null,"Loading saved recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-4"},"Saved Recipes"),n.length===0&&e.createElement("p",{className:"text-gray-500"},"No saved recipes yet."),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},n.map(m=>e.createElement("div",{key:m.id,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:m.thumbnail,alt:m.title,className:"rounded-lg mb-2"}),e.createElement("h3",{className:"font-bold"},m.title),e.createElement("button",{onClick:()=>u(m.id),className:"mt-2 text-red-600 hover:underline"},"Remove"),e.createElement("button",{onClick:()=>f(m),className:"mt-3 text-blue-600 hover:underline"},"View")))))}async function T(t){const n=(await I(t)).map(o=>o.allergen.toLowerCase()),{data:s,error:r}=await v.from("related_foods").select("ingredients");r&&console.error("Related foods error:",r);const c=s?s.flatMap(o=>o.ingredients.map(u=>u.toLowerCase())):[];return[...new Set([...n,...c])]}async function $(){return(await(await fetch("https://www.themealdb.com/api/json/v1/1/search.php?s=")).json()).meals||[]}function w(t){const a=[];for(let n=1;n<=20;n++){const s=t[`strIngredient${n}`];s&&s.trim()&&a.push(s.toLowerCase())}return a}function q(t,a){return t.filter(n=>!w(n).some(c=>a.some(o=>c.includes(o))))}function K(t,a){if(a==="all")return t;const n=["chicken","beef","pork","lamb","mutton","fish","shrimp","prawn","egg","bacon","ham","gelatin","anchovy","tuna","salmon","crab","meat"];return t.filter(s=>{const c=w(s).some(o=>n.some(u=>o.includes(u)));return a==="veg"?!c:a==="non-veg"?c:!0})}function F(t,a){return a==="all"?t:t.filter(n=>n.strCategory===a)}async function Y(t,a){const{data:n,error:s}=await v.from("saved_recipes").select("recipe_id").eq("user_id",t);if(s)return console.error("Saved recipes error:",s),a;const r=n.map(c=>c.recipe_id);return a.filter(c=>!r.includes(c.idMeal))}async function Z({userId:t,dietType:a="all",category:n="all"}){const s=await T(t);let r=await $();return r=q(r,s),r=K(r,a),r=F(r,n),r=await Y(t,r),r}function G(){const{user:t}=x(),a=t==null?void 0:t.id,[n,s]=i.useState([]),[r,c]=i.useState(!0),[o,u]=i.useState("all"),[g,f]=i.useState("all"),[m,b]=i.useState(""),[p,h]=i.useState(null);i.useEffect(()=>{a&&E()},[a,o,g]);const E=async()=>{c(!0);const l=await Z({userId:a,dietType:o,category:g});s(l),c(!1)},d=async l=>{if(!a)return;b(l.idMeal);const{error:y}=await L(a,l.strMeal,l.strMealThumb,l.idMeal);y||s(R=>R.filter(k=>k.idMeal!==l.idMeal)),b("")};return r?e.createElement("p",{className:"text-gray-500"},"Loading recipes…"):n.length===0?e.createElement("p",{className:"text-gray-500"},"No safe recipes found based on your filters."):e.createElement(e.Fragment,null,e.createElement("div",{className:"flex flex-wrap gap-3 mb-6"},e.createElement("select",{className:"border p-2 rounded",value:o,onChange:l=>u(l.target.value)},e.createElement("option",{value:"all"},"All"),e.createElement("option",{value:"veg"},"Veg"),e.createElement("option",{value:"non-veg"},"Non-Veg")),e.createElement("select",{className:"border p-2 rounded",value:g,onChange:l=>f(l.target.value)},e.createElement("option",{value:"all"},"All Categories"),e.createElement("option",{value:"Dessert"},"Dessert"),e.createElement("option",{value:"Miscellaneous"},"Misc"),e.createElement("option",{value:"Chicken"},"Chicken"),e.createElement("option",{value:"Beef"},"Beef"),e.createElement("option",{value:"Seafood"},"Seafood"))),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5"},n.map(l=>e.createElement("div",{key:l.idMeal,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:l.strMealThumb,alt:l.strMeal,className:"rounded-lg mb-3"}),e.createElement("h3",{className:"font-bold text-lg"},l.strMeal),e.createElement("p",{className:"text-sm text-gray-600"},"Category: ",l.strCategory),e.createElement("div",{className:"flex gap-3 mt-3"},e.createElement("button",{onClick:()=>d(l),disabled:m===l.idMeal,className:"text-white px-3 py-2 rounded",style:{background:"var(--sb-accent)",opacity:m===l.idMeal?.6:1}},m===l.idMeal?"Saving…":"Save"),e.createElement("button",{onClick:()=>h(l),className:"px-3 py-2 border rounded"},"View"))))),p&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},e.createElement("div",{className:"bg-white w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-xl shadow-xl p-6 relative"},e.createElement("button",{onClick:()=>h(null),className:"absolute top-3 right-3 text-gray-500 hover:text-black text-lg"},"✕"),e.createElement("h2",{className:"text-2xl font-bold mb-4"},p.strMeal),e.createElement("h3",{className:"font-semibold mb-2"},"Ingredients"),e.createElement("ul",{className:"list-disc ml-6 mb-4"},w(p).map((l,y)=>e.createElement("li",{key:y},l))),e.createElement("h3",{className:"font-semibold mb-2"},"Instructions"),e.createElement("p",{className:"text-gray-700 whitespace-pre-line"},p.strInstructions))))}function P(){const[t,a]=i.useState("mine");return e.createElement("div",{className:"max-w-4xl mx-auto"},e.createElement("h1",{className:"text-3xl font-bold mb-6"},"Recipes"),e.createElement("div",{className:"flex gap-3 mb-6"},e.createElement("button",{onClick:()=>a("mine"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="mine"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(S,{size:18})," My Recipes"),e.createElement("button",{onClick:()=>a("recommended"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="recommended"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(A,{size:18})," Recommended"),e.createElement("button",{onClick:()=>a("saved"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${t==="saved"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(_,{size:18})," Saved")),t==="mine"&&e.createElement(z,null),t==="recommended"&&e.createElement(G,null),t==="saved"&&e.createElement(j,null))}export{P as default};
