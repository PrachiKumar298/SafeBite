import{c as N,s as v,u as w,r as i,R as e,B as S}from"./index-CXFvRSxz.js";import{g as C,d as M,s as I}from"./savedRecipesService-DBvz0NBC.js";import{g as L}from"./allergyService-Cm5QmLgG.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=N("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=N("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);async function j(a){const{data:t}=await v.from("my_recipes").select("*").eq("user_id",a).order("created_at",{ascending:!1});return t||[]}async function B(a,t,n,s){await v.from("my_recipes").insert({user_id:a,title:t,ingredients:n,instructions:s})}async function z(a){await v.from("my_recipes").delete().eq("id",a)}function D(){const{user:a}=w(),t=a==null?void 0:a.id,[n,s]=i.useState(""),[l,c]=i.useState(""),[o,g]=i.useState(""),[m,b]=i.useState([]),[d,p]=i.useState(!0);i.useEffect(()=>{t&&f()},[t]);const f=async()=>{p(!0);const u=await j(t);b(u),p(!1)},h=async()=>{n.trim()&&(await B(t,n,l.split(","),o),s(""),c(""),g(""),f())},y=async u=>{await z(u),f()};return d?e.createElement("div",null,"Loading your recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Add New Recipe"),e.createElement("div",{className:"p-4 bg-white rounded-lg shadow mb-8"},e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Recipe Title",value:n,onChange:u=>s(u.target.value)}),e.createElement("input",{className:"w-full p-3 border rounded mb-3",placeholder:"Ingredients (comma separated)",value:l,onChange:u=>c(u.target.value)}),e.createElement("textarea",{className:"w-full p-3 border rounded mb-3",placeholder:"Instructions",value:o,onChange:u=>g(u.target.value)}),e.createElement("button",{className:"px-4 py-2 text-white rounded-lg",style:{background:"var(--sb-accent)"},onClick:h},"Save Recipe")),e.createElement("h2",{className:"text-xl font-semibold mb-3"},"Your Recipes"),m.length===0&&e.createElement("p",{className:"text-gray-500"},"No recipes yet."),e.createElement("div",{className:"space-y-4"},m.map(u=>e.createElement("div",{key:u.id,className:"p-4 bg-amber-50 rounded-lg"},e.createElement("h3",{className:"font-bold text-lg"},u.title),e.createElement("p",{className:"text-sm mt-1"},e.createElement("strong",null,"Ingredients:")," ",u.ingredients.join(", ")),e.createElement("p",{className:"text-sm mt-1 whitespace-pre-wrap"},u.instructions),e.createElement("button",{onClick:()=>y(u.id),className:"mt-3 text-red-600 hover:underline"},"Delete")))))}function V(){const{user:a}=w(),t=a==null?void 0:a.id,[n,s]=i.useState([]),[l,c]=i.useState(!0);i.useEffect(()=>{t&&o()},[t]);const o=async()=>{c(!0);const d=await C(t);s(d),c(!1)},g=async d=>{await M(d),o()},[m,b]=i.useState(null);return l?e.createElement("div",null,"Loading saved recipes..."):e.createElement("div",null,e.createElement("h2",{className:"text-xl font-semibold mb-4"},"Saved Recipes"),n.length===0&&e.createElement("p",{className:"text-gray-500"},"No saved recipes yet."),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},n.map(d=>e.createElement("div",{key:d.id,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:d.thumbnail,alt:d.title,className:"rounded-lg mb-2"}),e.createElement("h3",{className:"font-bold"},d.title),e.createElement("div",{className:"flex gap-3 mt-4"},e.createElement("button",{onClick:()=>{console.log("Selected recipe:",d),b(d)},className:"flex-1 px-3 py-2 rounded-lg border text-sm font-medium transition",style:{borderColor:"var(--sb-accent)",color:"var(--sb-accent)",background:"transparent"},onMouseEnter:p=>p.target.style.background="rgba(0,0,0,0.03)",onMouseLeave:p=>p.target.style.background="transparent"},"View"),e.createElement("button",{onClick:()=>g(d.id),className:"flex-1 px-3 py-2 rounded-lg text-white text-sm font-medium transition",style:{background:"var(--sb-accent)",opacity:1},onMouseEnter:p=>p.target.style.opacity="0.85",onMouseLeave:p=>p.target.style.opacity="1"},"Remove")),m&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>b(null)},e.createElement("div",{className:"bg-white w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-xl shadow-xl p-6 relative",onClick:p=>p.stopPropagation()},e.createElement("button",{onClick:()=>b(null),className:"absolute top-3 right-3 text-gray-500 hover:text-black text-lg"},"✕"),e.createElement("h2",{className:"text-2xl font-bold mb-4"},m.title),m.ingredients&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"font-semibold mb-2"},"Ingredients"),e.createElement("p",{className:"mb-4"},Array.isArray(m.ingredients)?m.ingredients.join(", "):m.ingredients)),m.instructions&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"font-semibold mb-2"},"Instructions"),e.createElement("p",{className:"whitespace-pre-line"},m.instructions))))))))}async function T(a){const n=(await L(a)).map(o=>o.allergen.toLowerCase()),{data:s,error:l}=await v.from("related_foods").select("ingredients");l&&console.error("Related foods error:",l);const c=s?s.flatMap(o=>o.ingredients.map(g=>g.toLowerCase())):[];return[...new Set([...n,...c])]}async function $(a=10){const t=[];for(let n=0;n<a;n++){const l=await(await fetch("https://www.themealdb.com/api/json/v1/1/random.php")).json();l.meals&&l.meals[0]&&t.push(l.meals[0])}return t}function E(a){const t=[];for(let n=1;n<=20;n++){const s=a[`strIngredient${n}`];s&&s.trim()&&t.push(s.toLowerCase())}return t}function q(a,t){return a.filter(n=>!E(n).some(c=>t.some(o=>c.includes(o))))}function F(a,t){if(t==="all")return a;const n=["chicken","beef","pork","lamb","mutton","fish","shrimp","prawn","egg","bacon","ham","gelatin","anchovy","tuna","salmon","crab","meat","seafood","duck"];return a.filter(s=>{const c=E(s).some(g=>n.some(m=>g.includes(m))),o=s.strCategory&&s.strCategory.toLowerCase().includes("seafood");return t==="veg"?!c&&!o:t==="non-veg"?c||o:!0})}function K(a,t){return t==="all"?a:a.filter(n=>n.strCategory===t)}async function P(a,t){const{data:n,error:s}=await v.from("saved_recipes").select("recipe_id").eq("user_id",a);if(s)return console.error("Saved recipes error:",s),Z(t).slice(0,8);const l=n.map(c=>c.recipe_id);return t.filter(c=>!l.includes(c.idMeal))}async function Y({userId:a,dietType:t="all",category:n="all"}){const s=await T(a);let l=await $(12);return l=q(l,s),l=F(l,t),l=K(l,n),l=await P(a,l),l}function Z(a){return a.map(t=>({value:t,sort:Math.random()})).sort((t,n)=>t.sort-n.sort).map(({value:t})=>t)}function G(){const{user:a}=w(),t=a==null?void 0:a.id,[n,s]=i.useState([]),[l,c]=i.useState(!0),[o,g]=i.useState("all"),[m,b]=i.useState("all"),[d,p]=i.useState(""),[f,h]=i.useState(null);i.useEffect(()=>{t&&y()},[t,o,m]);const y=async()=>{c(!0);const r=await Y({userId:t,dietType:o,category:m});s(r),c(!1)},u=async r=>{if(!t)return;p(r.idMeal);const{error:x}=await I(t,r.strMeal,r.strMealThumb,r.idMeal,E(r),r.strInstructions);x||s(k=>k.filter(R=>R.idMeal!==r.idMeal)),p("")};return l?e.createElement("p",{className:"text-gray-500"},"Loading recipes…"):e.createElement(e.Fragment,null,e.createElement("div",{className:"flex justify-between items-center mb-4"},e.createElement("h2",{className:"text-xl font-semibold"},"Recommended Recipes"),e.createElement("button",{onClick:y,className:"px-4 py-2 text-white rounded-lg",style:{background:"var(--sb-accent)"}},"Refresh Recipes")),e.createElement("div",{className:"flex flex-wrap gap-3 mb-6"},e.createElement("select",{className:"border p-2 rounded",value:o,onChange:r=>g(r.target.value)},e.createElement("option",{value:"all"},"All"),e.createElement("option",{value:"veg"},"Veg"),e.createElement("option",{value:"non-veg"},"Non-Veg")),e.createElement("select",{className:"border p-2 rounded",value:m,onChange:r=>b(r.target.value)},e.createElement("option",{value:"all"},"All Categories"),e.createElement("option",{value:"Dessert"},"Dessert"),e.createElement("option",{value:"Miscellaneous"},"Misc"),e.createElement("option",{value:"Chicken"},"Chicken"),e.createElement("option",{value:"Beef"},"Beef"),e.createElement("option",{value:"Seafood"},"Seafood"))),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5"},n.length===0?e.createElement("div",{className:"col-span-full text-center text-gray-500 py-10"},e.createElement("p",{className:"text-lg font-medium"},"No safe recipes found for this filter."),e.createElement("button",{onClick:y,className:"mt-4 px-4 py-2 text-white rounded-lg",style:{background:"var(--sb-accent)"}},"Try Refreshing")):n.map(r=>e.createElement("div",{key:r.idMeal,className:"p-4 bg-white shadow rounded-lg"},e.createElement("img",{src:r.strMealThumb,alt:r.strMeal,className:"rounded-lg mb-3"}),e.createElement("h3",{className:"font-bold text-lg"},r.strMeal),e.createElement("p",{className:"text-sm text-gray-600"},"Category: ",r.strCategory),e.createElement("div",{className:"flex gap-3 mt-3"},e.createElement("button",{onClick:()=>u(r),disabled:d===r.idMeal,className:"text-white px-3 py-2 rounded",style:{background:"var(--sb-accent)",opacity:d===r.idMeal?.6:1}},d===r.idMeal?"Saving…":"Save"),e.createElement("button",{onClick:()=>h(r),className:"px-3 py-2 border rounded hover:bg-gray-50"},"View"))))),f&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},e.createElement("div",{className:"bg-white w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-xl shadow-xl p-6 relative"},e.createElement("button",{onClick:()=>h(null),className:"absolute top-3 right-3 text-gray-500 hover:text-black text-lg"},"✕"),e.createElement("h2",{className:"text-2xl font-bold mb-4"},f.strMeal),e.createElement("h3",{className:"font-semibold mb-2"},"Ingredients"),e.createElement("ul",{className:"list-disc ml-6 mb-4"},E(f).map((r,x)=>e.createElement("li",{key:x},r))),e.createElement("h3",{className:"font-semibold mb-2"},"Instructions"),e.createElement("p",{className:"text-gray-700 whitespace-pre-line"},f.strInstructions))))}function Q(){const[a,t]=i.useState("mine");return e.createElement("div",{className:"max-w-4xl mx-auto"},e.createElement("h1",{className:"text-3xl font-bold mb-6"},"Recipes"),e.createElement("div",{className:"flex gap-3 mb-6"},e.createElement("button",{onClick:()=>t("mine"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${a==="mine"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(S,{size:18})," My Recipes"),e.createElement("button",{onClick:()=>t("recommended"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${a==="recommended"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(_,{size:18})," Recommended"),e.createElement("button",{onClick:()=>t("saved"),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${a==="saved"?"bg-amber-600 text-white":"bg-amber-100"}`},e.createElement(A,{size:18})," Saved")),a==="mine"&&e.createElement(D,null),a==="recommended"&&e.createElement(G,null),a==="saved"&&e.createElement(V,null))}export{Q as default};
